Bootstrap: docker
From: debian:bullseye-slim

%labels
    Maintainer Testground Maintainers
    Description Testground sidecar packaged for Apptainer/Singularity
    Version edge

%help
    Build the Testground binary on the host first, then run:
        apptainer build testground-sidecar.sif contrib/singularity/sidecar.def

%files
    build/linux/testground /usr/local/bin/testground

%post
    set -eux
    apt-get update
    apt-get install -y --no-install-recommends ca-certificates iptables
    rm -rf /var/lib/apt/lists/*
    mkdir -p /usr/local/bin
    chmod 0755 /usr/local/bin/testground

%environment
    export PATH="/usr/local/bin:${PATH}"

%runscript
    exec /usr/local/bin/testground "$@"
